sudo: required
services:
- docker
env:
  global:
  - IMAGE_NAME=soniaauvets/airflow-ros-tensorflow
before_script:
- version="$(cat VERSION)"
script:
- docker build --pull --cache-from "$IMAGE_NAME" --tag "$IMAGE_NAME" --build-arg GCLOUD_SERVICE_ACCOUNT_EMAIL="${GCLOUD_SERVICE_ACCOUNT_EMAIL}"
  .
after_script:
- docker images
before_deploy:
- docker login -u "$DOCKER_USERNAME" -p "$DOCKER_PASSWORD"
- docker tag "$IMAGE_NAME" "${IMAGE_NAME}:latest"
deploy:
- provider: script
  script: docker tag "$IMAGE_NAME" "${IMAGE_NAME}:dev" && docker push "${IMAGE_NAME}:latest"
    && docker push "${IMAGE_NAME}:dev"
  on:
    branch: dev
- provider: script
  script: docker tag "$IMAGE_NAME" "${IMAGE_NAME}:${version}" && docker push "${IMAGE_NAME}:latest"
    && docker push "${IMAGE_NAME}:${version}"
  on:
    branch: master
notifications:
  slack:
    secure: XE23tJuTz3zNsp78ukjfiliUKrjGG9K1HwUwZ9syYXs6vWV5XDxbgx6R1wEQjL/n8Iz3n1NA32hsa9MxXxlcCS2qLc2F9BFFNrPbU7LL7bMGqfqkNYWvmoHi5nsMpG1zKW/kF5oo0MkkGIm2X9OMBLcTbWxoOpkVB1pf4gO8NJqzEU62vAccePugNnWF6B0V04ypBJc5YnutUL5Qw4+ez3OBCQniVrxK5UVfF0hBSA5IFbK9z03eVhnJg4a961HQCQ02LQ5ylJQ3Cn0tXr1nih1qUKwG7p8g/ijboagMtbUxbpXwKAs7xN5io85cyYETjvLowkFYFPIXoltKFm8pp9myRobd2UMzKXeobFts4bOYk8NjgHBytZov6GKkCL+ajfGzBs7km/ckjivtQmsVw39WOC1pHS+tegyws3UOnz3ULWX3OvEQtosS/s9SMSfg/isvfOT2lwedGs4flKI7CGlp+ZoHkbX9qxhl9W1kI/F9onGA2PWMorqvlxHGbDMKjOA++OwETPL5/B1yQCb/efMabEzwIrc0K+c/m3y5gT0bhBksgjXIqOIRrIKCIrxWygiE4L6IX1QqQyruv8mjLks5u/NUQisL+PHbauA+Bfr2veA9eUjCS4XWgMoCPnkq8sIFu5c5pmB2pn2y7Jmgjk8876NgGNAYUzKpxp02F9E=
